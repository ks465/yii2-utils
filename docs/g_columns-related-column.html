<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/afbdca15/css/bootstrap.css" rel="stylesheet">
<link href="./assets/9af5cddc/solarized_light.css" rel="stylesheet">
<link href="./assets/34135542/style.css" rel="stylesheet">
<script src="./assets/84a200c2/jquery.js"></script>
<script src="./assets/afbdca15/js/bootstrap.js"></script>
<script src="./assets/96f6715f/jssearch.js"></script>    <title>Related Column - Columns - KHanUtilsGuide</title>
</head>
<body>

<div class="wrap">
    <nav id="w460" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w460-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">KHanUtilsGuide</a></div><div id="w460-collapse" class="collapse navbar-collapse"><ul id="w461" class="navbar-nav nav"><li><a href="./g_README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-448" data-toggle="collapse" data-parent="#navigation">Documentation <b class="caret"></b></a><div id="navigation-448" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_documents.html">Document Tips and Tricks</a>
<a class="list-group-item" href="./g_persian.html">Setup for Persian</a>
<a class="list-group-item" href="./g_full-config.html">Complete Config</a>
<a class="list-group-item" href="./g_workflow.html">Workflow</a></div>
<a class="list-group-item" href="#navigation-449" data-toggle="collapse" data-parent="#navigation">Behaviors <b class="caret"></b></a><div id="navigation-449" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_workflow.html#WorkflowBehavior">WorkflowBehavior</a>
<a class="list-group-item" href="./g_behaviors-eav-behavior.html">EavBehavior</a>
<a class="list-group-item" href="./g_behaviors-eav-trait.html">EavQueryTrait</a></div>
<a class="list-group-item" href="#navigation-450" data-toggle="collapse" data-parent="#navigation">Components <b class="caret"></b></a><div id="navigation-450" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_components-array-helper.html">Array Helper</a>
<a class="list-group-item" href="./g_components-file-helper.html">File Helper</a>
<a class="list-group-item" href="./g_components-jalali.html">Jalali and JalaliX</a>
<a class="list-group-item" href="./g_components-math-helper.html">Math Helper</a>
<a class="list-group-item" href="./g_components-sql-formatter.html">SQL Formatter</a>
<a class="list-group-item" href="./g_components-string-helper.html">String Helper</a>
<a class="list-group-item" href="./g_components-view-helper.html">View Helper</a></div>
<a class="list-group-item" href="#navigation-451" data-toggle="collapse" data-parent="#navigation">Controllers <b class="caret"></b></a><div id="navigation-451" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_controllers-khan-console.html">KHan Console</a>
<a class="list-group-item" href="./g_controllers-khan-rest.html">KHan Rest</a>
<a class="list-group-item" href="./g_controllers-khan-web.html">KHan Web</a>
<a class="list-group-item" href="./g_controllers-system-tables.html">System Tables</a></div>
<a class="list-group-item active" href="#navigation-452" data-toggle="collapse" data-parent="#navigation">Columns <b class="caret"></b></a><div id="navigation-452" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./g_columns-action-column.html">Action Column</a>
<a class="list-group-item" href="./g_columns-boolean-column.html">Boolean Column</a>
<a class="list-group-item" href="./g_columns-data-column.html">Data Column</a>
<a class="list-group-item" href="./g_columns-enum-column.html">Enum Column</a>
<a class="list-group-item" href="./g_columns-jalali-column.html">Jalali Column</a>
<a class="list-group-item" href="./g_workflow.html#ProgressColumn">Progress Column</a>
<a class="list-group-item" href="./g_columns-radio-column.html">Radio Column</a>
<a class="list-group-item active" href="./g_columns-related-column.html">Related Column</a></div>
<a class="list-group-item" href="#navigation-453" data-toggle="collapse" data-parent="#navigation">Models <b class="caret"></b></a><div id="navigation-453" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_models-khan-model.html">Base Model</a>
<a class="list-group-item" href="./g_models-khan-user.html">Base user</a>
<a class="list-group-item" href="./g_models-khan-identity.html">Identity</a></div>
<a class="list-group-item" href="#navigation-454" data-toggle="collapse" data-parent="#navigation">RBAC <b class="caret"></b></a><div id="navigation-454" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_rbac-rule-owner.html">Owner Rule</a></div>
<a class="list-group-item" href="#navigation-455" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-455" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_widgets-date-picker.html">Date Picker</a>
<a class="list-group-item" href="./g_widgets-date-range-picker.html">Date Range Picker</a>
<a class="list-group-item" href="./g_widgets-grid-view.html">Grid View</a>
<a class="list-group-item" href="./g_widgets-dropdown.html">AJAX Dropdown</a>
<a class="list-group-item" href="./g_widgets-export-menu.html">Export Menu</a>
<a class="list-group-item" href="./g_widgets-confirm-button.html">Confirm Button</a>
<a class="list-group-item" href="./g_widgets-captcha.html">Captcha</a>
<a class="list-group-item" href="./g_widgets-export-menu.html">ExportMenu</a></div>
<a class="list-group-item" href="#navigation-456" data-toggle="collapse" data-parent="#navigation">Others <b class="caret"></b></a><div id="navigation-456" class="submenu panel-collapse collapse"><a class="list-group-item" href="./g_helpers-app-builder.html">App Builder</a>
<a class="list-group-item" href="./g_helpers-system-table-builder.html">System table Builder</a>
<a class="list-group-item" href="./g_helpers-genrators.html">Generators</a>
<a class="list-group-item" href="./g_components-var-dump.html">VarDump</a>
<a class="list-group-item" href="./g_components-sql-formatter.html">SqlFormatter</a>
<a class="list-group-item" href="./g_settings.html">Settings</a>
<a class="list-group-item" href="./g_helpers-migrations.html">Migrations</a>
<a class="list-group-item" href="./g_widgets-menu.html">Overlay Menu</a>
<a class="list-group-item" href="./g_components-workflow.html">Workflow Manager</a>
<a class="list-group-item" href="./g_components-wiz-flow.html">Wizard Flow</a>
<a class="list-group-item" href="./g_tests.html">Tests</a>
<a class="list-group-item" href="./g_module-khan-tools.html">Tools Module</a></div>
<a class="list-group-item" href="#navigation-457" data-toggle="collapse" data-parent="#navigation">StartUp <b class="caret"></b></a><div id="navigation-457" class="submenu panel-collapse collapse"></div>
<a class="list-group-item" href="#navigation-458" data-toggle="collapse" data-parent="#navigation">Sanitizing User Input <b class="caret"></b></a><div id="navigation-458" class="submenu panel-collapse collapse"></div>
<a class="list-group-item" href="#navigation-459" data-toggle="collapse" data-parent="#navigation">RBAC Setup <b class="caret"></b></a><div id="navigation-459" class="submenu panel-collapse collapse"></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>RelatedColumn <span id="relatedcolumn"></span><a href="#relatedcolumn" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#childcolumns">child/_columns:</a></li>
<li><a href="#childform">child/_form:</a></li>
<li><a href="#parentview">parent/view:</a></li>
<li><a href="#childcontroller">ChildController:</a></li></ol></div>
<p>Documentation Edition: 1.1-971126
Class Version: 0.1.2-971126</p>
<p>RelatedColumn adds a column with Select2 filter and sort  a column in foreign key reference.
Required configurations are:</p>
<ul>
<li><code>class =&gt; '\khans\utils\columns\RelatedColumn',</code> </li>
<li><code>attribute</code> name of the field in child table referring the parent PK</li>
<li><code>targetTable</code> model presenting the parent table</li>
<li><code>titleField</code> name of field in parent table which should be used as the title of the parent records, and are shown in the child grid view and search is based on this parent column.</li>
<li><code>value</code> a callback for showing the title in the child's grid as a link to parent grid view method</li>
<li><code>group =&gt; true,</code> </li>
<li><code>searcherUrl</code> array to the action responsible for filtering the field. Defaults to <code>parents</code></li>
</ul>
<p><strong><em>Example:</em></strong>
The suggested updates to various files are based on this partial table definition:</p>
<pre><code class="language-mysql">CREATE TABLE `parent_table` (
  `id` SMALLINT(6) UNSIGNED NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(255) COLLATE UTF8_PERSIAN_CI NOT NULL
);
CREATE TABLE `child_table` (
  `id` SMALLINT(6) UNSIGNED NOT NULL AUTO_INCREMENT,
  `parent_id` SMALLINT(6) UNSIGNED NOT NULL AUTO_INCREMENT,
  KEY `fk_parent_child` (`parent_id`),
   CONSTRAINT `fk_parent_child` FOREIGN KEY (`parent_id`) REFERENCES `parent_table` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
);
</code></pre>
<h2>child/_columns: <span id="childcolumns"></span><a href="#childcolumns" class="hashlink">&para;</a></h2><p>Define a RelatedColumn. But if the grid view is in the parent view page, drop the referencing column.
In order to ensure correct working of the ActionColumn links in both stand alone and view page, add the <code>controller</code> config to it.</p>
<p><code>value</code> in the <code>RelatedColumn</code> column definition defaults to:
<code>`</code>php
function($model) {</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$model</span>-&gt;parent)){
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$model</span>-&gt;parent-&gt;{<span class="hljs-variable">$this</span>-&gt;titleField};
}
<span class="hljs-keyword">return</span> <span class="hljs-variable">$model</span>-&gt;{<span class="hljs-variable">$this</span>-&gt;attribute};
</code></pre>
<p>}
<code>For the above default value to work properly, the child model should implement a relationship as:</code>php
public function getParent(){</p>
<pre><code class="hljs php"><span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;hasOne(ParentModel::class, [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-string">'parent_id'</span>]);
</code></pre>
<p>}
<code>`</code>
The following config, on the other hand, renders a link anchor to the parent view page.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">#19: //field showing the field referencing the parent</span>
<span class="hljs-string">'parent'</span> =&gt; [
    <span class="hljs-string">'class'</span>          =&gt; <span class="hljs-string">'\khans\utils\columns\RelatedColumn'</span>,
    <span class="hljs-string">'attribute'</span>      =&gt; <span class="hljs-string">'parent_id'</span>, <span class="hljs-comment">// in the child table</span>
    <span class="hljs-string">'targetModel'</span>    =&gt; <span class="hljs-string">'\namespace\ParentModel'</span>,
    <span class="hljs-string">'titleField'</span>     =&gt; <span class="hljs-string">'title'</span>, <span class="hljs-comment">// in the parent table</span>
    <span class="hljs-string">'value'</span>          =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-variable">$model</span>)</span> </span>{
        <span class="hljs-keyword">return</span> \yii\helpers\Html::a(<span class="hljs-variable">$model</span>-&gt;parent-&gt;title . <span class="hljs-string">'&lt;i class="fa fa-external-link"&gt;&lt;/i&gt;'</span>,
            [<span class="hljs-string">'/module/parent/view'</span>, <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$model</span>-&gt;parent_id],
            [<span class="hljs-string">'data-pjax'</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">'role'</span> =&gt; <span class="hljs-string">''</span>]
        );
    },
    <span class="hljs-string">'group'</span>          =&gt; <span class="hljs-keyword">true</span>,
    <span class="hljs-string">'hAlign'</span>         =&gt; GridView::ALIGN_RIGHT,
    <span class="hljs-string">'vAlign'</span>         =&gt; GridView::ALIGN_MIDDLE,
    <span class="hljs-string">'headerOptions'</span>  =&gt; [<span class="hljs-string">'style'</span> =&gt; <span class="hljs-string">'text-align: center;'</span>],
    <span class="hljs-string">'contentOptions'</span> =&gt; [<span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'pars-wrap'</span>],
],

<span class="hljs-comment">#99: // add this to `ActionColumn` to ensure grid view works correctly in parent view and stand alone</span>
<span class="hljs-string">'controller'</span> =&gt; <span class="hljs-string">'child/controller'</span>,

<span class="hljs-comment">#102: // setting `$parent = true;` in the parent view drops the referencing column</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$parent</span>) <span class="hljs-keyword">and</span> <span class="hljs-variable">$parent</span>){
    \khans\utils\components\ArrayHelper::remove(<span class="hljs-variable">$column</span>, <span class="hljs-string">'parent'</span>);
}
</code></pre>
<h2>child/_form: <span id="childform"></span><a href="#childform" class="hashlink">&para;</a></h2><p>Instead of text input for the <code>parent_id</code> column, use <code>Select2</code> widget and read data from parent table. Please note that if the parent table has large number of records this approach is not recommended. Instead use AJAX data loader for the Select2 widget.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">#4:</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">kartik</span>\<span class="hljs-title">select2</span>\<span class="hljs-title">Select2</span>;

<span class="hljs-comment">#21:</span>
<span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$form</span>-&gt;field(<span class="hljs-variable">$model</span>, <span class="hljs-string">'parent_id'</span>)-&gt;widget(Select2::class, [
    <span class="hljs-string">'theme'</span> =&gt; Select2::THEME_BOOTSTRAP,
    <span class="hljs-string">'initValueText'</span> =&gt; ArrayHelper::getValue(ParentModel::findOne(<span class="hljs-variable">$model</span>-&gt;parent_id), <span class="hljs-string">'parent_title'</span>),
    <span class="hljs-string">'pluginOptions'</span> =&gt; [
        <span class="hljs-string">'allowClear'</span>         =&gt; <span class="hljs-keyword">true</span>,
        <span class="hljs-string">'dir'</span>                =&gt; <span class="hljs-string">'rtl'</span>,
        <span class="hljs-string">'minimumInputLength'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'ajax'</span>               =&gt; [
            <span class="hljs-string">'url'</span>      =&gt; Url::to([<span class="hljs-string">'parents'</span>]),
            <span class="hljs-string">'dataType'</span> =&gt; <span class="hljs-string">'json'</span>,
            <span class="hljs-string">'data'</span>     =&gt; <span class="hljs-keyword">new</span> JsExpression(<span class="hljs-string">'function(params) { return {q:params.term}; }'</span>),
        ],
    ],
]) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<h2>parent/view: <span id="parentview"></span><a href="#parentview" class="hashlink">&para;</a></h2><p>First build search model and data provider for the child grid view.
For best results set the sort of data to a static type.
Set <code>$parent = true;</code> to signal the child grid view to drop the referencing column to the parent.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">#14:</span>
<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $model ParntModel */</span>
<span class="hljs-variable">$searchModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-keyword">namespace</span>\<span class="hljs-title">ChildModelSearch</span>([ 
    '<span class="hljs-title">query</span>'=&gt; $<span class="hljs-title">model</span>-&gt;<span class="hljs-title">getChildren</span>()-&gt;<span class="hljs-title">orderBy</span>(['<span class="hljs-title">title</span>'=&gt;<span class="hljs-title">SORT_ASC</span>, '<span class="hljs-title">id</span>'=&gt;<span class="hljs-title">SORT_ASC</span>]),
]);
<span class="hljs-variable">$dataProvider</span> = <span class="hljs-variable">$searchModel</span>-&gt;search(Yii::<span class="hljs-variable">$app</span>-&gt;request-&gt;queryParams);
<span class="hljs-variable">$dataProvider</span>-&gt;setSort(<span class="hljs-keyword">false</span>);

<span class="hljs-variable">$parent</span> = <span class="hljs-keyword">true</span>;

<span class="hljs-comment">#55:</span>
&lt;div id=<span class="hljs-string">"ajaxCrudDatatable"</span>&gt;
    <span class="hljs-preprocessor">&lt;?</span>= khans\utils\widgets\GridView::widget([
        <span class="hljs-string">'id'</span>                 =&gt; <span class="hljs-string">'child-datatable-pjax'</span>,
        <span class="hljs-string">'dataProvider'</span>       =&gt; <span class="hljs-variable">$dataProvider</span>,
        <span class="hljs-string">'filterModel'</span>        =&gt; <span class="hljs-variable">$searchModel</span>,
        <span class="hljs-string">'columns'</span>            =&gt; <span class="hljs-keyword">require</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../child/_columns.php'</span>),
        <span class="hljs-string">'export'</span>             =&gt; <span class="hljs-keyword">true</span>,
        <span class="hljs-string">'showRefreshButtons'</span> =&gt; <span class="hljs-keyword">true</span>,
        <span class="hljs-string">'bulkAction'</span>         =&gt; [
            <span class="hljs-string">'action'</span>  =&gt; <span class="hljs-string">'bulk-delete'</span>,
            <span class="hljs-string">'label'</span>   =&gt; <span class="hljs-string">'پاک‌کن'</span>,
            <span class="hljs-string">'icon'</span>    =&gt; <span class="hljs-string">'trash'</span>,
            <span class="hljs-string">'class'</span>   =&gt; <span class="hljs-string">'btn btn-danger btn-xs'</span>,
            <span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'آیا اطمینان دارید همه را پا کنید؟'</span>,
        ],
        <span class="hljs-string">'createAction'</span>       =&gt; [
            <span class="hljs-string">'ajax'</span>    =&gt; <span class="hljs-keyword">true</span>,
            <span class="hljs-string">'action'</span>  =&gt; <span class="hljs-string">'child/controller/create'</span>
        ],
    ]) <span class="hljs-preprocessor">?&gt;</span>
&lt;/div&gt;
</code></pre>
<h2>ChildController: <span id="childcontroller"></span><a href="#childcontroller" class="hashlink">&para;</a></h2><p>The following action is target of the AJAX data loader in <code>RelatedColumn</code> filter.
Any child grid view containing <code>RelatedColumn</code> should have this method enabled in the child controller.
In the KHanS/Utils version 1.* these actions where centralized in a unique controller.
This approach eliminates requirement for adjusting the target of data loader, and at the same time all the related actions are gathered together.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">#259:</span>
<span class="hljs-comment">/**
 * Action for AJAX data loader of a Select2 filter in [[RelatedColumn]]
 *
 * <span class="hljs-doctag">@param</span> string $q part of title/name field of the parent referee table
 *
 * <span class="hljs-doctag">@return</span> array record found matching the requested parameter
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionParents</span><span class="hljs-params">(<span class="hljs-variable">$q</span>)</span>
</span>{
    \Yii::<span class="hljs-variable">$app</span>-&gt;response-&gt;format = Response::FORMAT_JSON;
    <span class="hljs-variable">$out</span> = [<span class="hljs-string">'results'</span> =&gt; [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-string">''</span>, <span class="hljs-string">'text'</span> =&gt; <span class="hljs-string">''</span>]];
    <span class="hljs-variable">$query</span> = ParentModel::find()
        -&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'text'</span>=&gt;<span class="hljs-string">''</span>])
        -&gt;where([<span class="hljs-string">'like'</span>, <span class="hljs-string">'title'</span>, <span class="hljs-variable">$q</span>])
        -&gt;orderBy([<span class="hljs-string">'title'</span> =&gt; SORT_ASC,])
        -&gt;asArray()
    ;
    <span class="hljs-variable">$out</span>[<span class="hljs-string">'results'</span>] = <span class="hljs-variable">$query</span>-&gt;all();

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;
}
</code></pre>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Fri, 15 Feb 2019 13:08:05 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
